<app-header 
  [pageTitle]="'Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø²Ø¹ Ø§Ù„Ù…Ù„ÙƒÙŠØ©'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="form-wrapper">
    <div class="page-header">
      <h1>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø²Ø¹ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø± Ø±Ø¦ÙŠØ³ Ø§Ù„ÙˆØ²Ø±Ø§Ø¡</h1>
    </div>

    <form [formGroup]="displacementPostForm" (ngSubmit)="onSubmit()">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="branchCode">ÙƒÙˆØ¯ Ø§Ù„ÙØ±Ø¹ <span class="required">*</span></label>
            <input 
              type="text" 
              id="branchCode" 
              formControlName="branchCode"
              [class.error]="displacementPostForm.get('branchCode')?.invalid && displacementPostForm.get('branchCode')?.touched"
            />
            @if (displacementPostForm.get('branchCode')?.invalid && displacementPostForm.get('branchCode')?.touched) {
              <span class="error-message">ÙƒÙˆØ¯ Ø§Ù„ÙØ±Ø¹ Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="rentedBuildingCode">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø¤Ø¬Ø± <span class="required">*</span></label>
            <input 
              type="text" 
              id="rentedBuildingCode" 
              formControlName="rentedBuildingCode"
              [class.error]="displacementPostForm.get('rentedBuildingCode')?.invalid && displacementPostForm.get('rentedBuildingCode')?.touched"
            />
            @if (displacementPostForm.get('rentedBuildingCode')?.invalid && displacementPostForm.get('rentedBuildingCode')?.touched) {
              <span class="error-message">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø¤Ø¬Ø± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>
        </div>
      </div>

      <!-- Cabinet Decision Section -->
      <div class="form-section">
        <h2 class="section-title">Ù‚Ø±Ø§Ø± Ù…Ø¬Ù„Ø³ Ø§Ù„ÙˆØ²Ø±Ø§Ø¡</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="cabinetDecisionNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø±Ø§Ø± <span class="required">*</span></label>
            <input 
              type="text" 
              id="cabinetDecisionNumber" 
              formControlName="cabinetDecisionNumber"
              [class.error]="displacementPostForm.get('cabinetDecisionNumber')?.invalid && displacementPostForm.get('cabinetDecisionNumber')?.touched"
            />
            @if (displacementPostForm.get('cabinetDecisionNumber')?.invalid && displacementPostForm.get('cabinetDecisionNumber')?.touched) {
              <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø±Ø§Ø± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="cabinetDecisionDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø± <span class="required">*</span></label>
            <input 
              type="date" 
              id="cabinetDecisionDate" 
              formControlName="cabinetDecisionDate"
              [class.error]="displacementPostForm.get('cabinetDecisionDate')?.invalid && displacementPostForm.get('cabinetDecisionDate')?.touched"
            />
            @if (displacementPostForm.get('cabinetDecisionDate')?.invalid && displacementPostForm.get('cabinetDecisionDate')?.touched) {
              <span class="error-message">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>
        </div>
      </div>

      <!-- Official Gazette Publication Section -->
      <div class="form-section">
        <h2 class="section-title">Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø¬Ø±ÙŠØ¯Ø© Ø±Ø³Ù…ÙŠØ©</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="publicationCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø´Ø± <span class="required">*</span></label>
            <input 
              type="number" 
              id="publicationCount" 
              formControlName="publicationCount"
              [class.error]="displacementPostForm.get('publicationCount')?.invalid && displacementPostForm.get('publicationCount')?.touched"
            />
            @if (displacementPostForm.get('publicationCount')?.invalid && displacementPostForm.get('publicationCount')?.touched) {
              <span class="error-message">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø´Ø± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="publicationDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø± <span class="required">*</span></label>
            <input 
              type="date" 
              id="publicationDate" 
              formControlName="publicationDate"
              [class.error]="displacementPostForm.get('publicationDate')?.invalid && displacementPostForm.get('publicationDate')?.touched"
            />
            @if (displacementPostForm.get('publicationDate')?.invalid && displacementPostForm.get('publicationDate')?.touched) {
              <span class="error-message">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="educationProject">Ù…Ø´Ø±ÙˆØ¹ ØªØ±Ø¨ÙŠØ© ÙˆØªØ¹Ù„ÙŠÙ… <span class="required">*</span></label>
            <input 
              type="text" 
              id="educationProject" 
              formControlName="educationProject"
              [class.error]="displacementPostForm.get('educationProject')?.invalid && displacementPostForm.get('educationProject')?.touched"
            />
            @if (displacementPostForm.get('educationProject')?.invalid && displacementPostForm.get('educationProject')?.touched) {
              <span class="error-message">Ù…Ø´Ø±ÙˆØ¹ ØªØ±Ø¨ÙŠØ© ÙˆØªØ¹Ù„ÙŠÙ… Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>
        </div>
      </div>

      <!-- Display Lists Section -->
      <div class="form-section">
        <h2 class="section-title">ÙƒØ´ÙˆÙ Ø§Ù„Ø¹Ø±Ø¶</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="ownersCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ùƒ <span class="required">*</span></label>
            <input 
              type="number" 
              id="ownersCount" 
              formControlName="ownersCount"
              [class.error]="displacementPostForm.get('ownersCount')?.invalid && displacementPostForm.get('ownersCount')?.touched"
            />
            @if (displacementPostForm.get('ownersCount')?.invalid && displacementPostForm.get('ownersCount')?.touched) {
              <span class="error-message">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ùƒ Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="pricePerMeter">Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± <span class="required">*</span></label>
            <input 
              type="number" 
              id="pricePerMeter" 
              formControlName="pricePerMeter"
              [class.error]="displacementPostForm.get('pricePerMeter')?.invalid && displacementPostForm.get('pricePerMeter')?.touched"
            />
            @if (displacementPostForm.get('pricePerMeter')?.invalid && displacementPostForm.get('pricePerMeter')?.touched) {
              <span class="error-message">Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="dateFrom">ØªØ§Ø±ÙŠØ® Ù…Ù† <span class="required">*</span></label>
            <input 
              type="date" 
              id="dateFrom" 
              formControlName="dateFrom"
              [class.error]="displacementPostForm.get('dateFrom')?.invalid && displacementPostForm.get('dateFrom')?.touched"
            />
            @if (displacementPostForm.get('dateFrom')?.invalid && displacementPostForm.get('dateFrom')?.touched) {
              <span class="error-message">ØªØ§Ø±ÙŠØ® Ù…Ù† Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>

          <div class="form-group">
            <label for="dateTo">ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ <span class="required">*</span></label>
            <input 
              type="date" 
              id="dateTo" 
              formControlName="dateTo"
              [class.error]="displacementPostForm.get('dateTo')?.invalid && displacementPostForm.get('dateTo')?.touched"
            />
            @if (displacementPostForm.get('dateTo')?.invalid && displacementPostForm.get('dateTo')?.touched) {
              <span class="error-message">ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>
        </div>
      </div>

      <!-- Sale Forms Section -->
      <div class="form-section">
        <h2 class="section-title">Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¹</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="formsCount">Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª <span class="required">*</span></label>
            <input 
              type="number" 
              id="formsCount" 
              formControlName="formsCount"
              [class.error]="displacementPostForm.get('formsCount')?.invalid && displacementPostForm.get('formsCount')?.touched"
            />
            @if (displacementPostForm.get('formsCount')?.invalid && displacementPostForm.get('formsCount')?.touched) {
              <span class="error-message">Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ù…Ø·Ù„ÙˆØ¨</span>
            }
          </div>
        </div>
      </div>

      <!-- Status Messages -->
      @if (submitStatus() === 'success') {
        <div class="status-message success">
          âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­
        </div>
      }
      @if (submitStatus() === 'error') {
        <div class="status-message error">
          âœ— ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        <button type="button" class="btn btn-secondary" (click)="onReset()">
          Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        </button>
        <button type="button" class="btn btn-tertiary" (click)="navigateBack()">
          Ø±Ø¬ÙˆØ¹
        </button>
      </div>
    </form>

    <!-- Options Cards Section -->
    <div class="cards-section">
      <h2 class="cards-title">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h2>
      <div class="options-grid">
        @for (option of options; track option.id) {
          <div class="option-card" (click)="selectOption(option.id)">
            <div class="option-icon">{{ option.icon }}</div>
            <h3>{{ option.title }}</h3>
            <span class="arrow">â†’</span>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Final Compensation Modal -->
  @if (showFinalCompensationModal()) {
    <div class="modal-overlay" (click)="closeFinalCompensationModal()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Ø§Ù„ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
          <button class="modal-close" (click)="closeFinalCompensationModal()">Ã—</button>
        </div>

        <div class="modal-body">
          <!-- Add Form -->
          <form [formGroup]="finalCompensationForm" (ngSubmit)="submitFinalCompensation()">
            <div class="form-row">
              <div class="form-group">
                <label for="checkNumber">Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="checkNumber" 
                  formControlName="checkNumber"
                  [class.error]="finalCompensationForm.get('checkNumber')?.invalid && finalCompensationForm.get('checkNumber')?.touched"
                />
                @if (finalCompensationForm.get('checkNumber')?.invalid && finalCompensationForm.get('checkNumber')?.touched) {
                  <span class="error-message">Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label for="value">Ø§Ù„Ù‚ÙŠÙ…Ø© <span class="required">*</span></label>
                <input 
                  type="number" 
                  id="value" 
                  formControlName="value"
                  [class.error]="finalCompensationForm.get('value')?.invalid && finalCompensationForm.get('value')?.touched"
                />
                @if (finalCompensationForm.get('value')?.invalid && finalCompensationForm.get('value')?.touched) {
                  <span class="error-message">Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                }
              </div>

              <div class="form-group">
                <label for="date">Ø§Ù„ØªØ§Ø±ÙŠØ® <span class="required">*</span></label>
                <input 
                  type="date" 
                  id="date" 
                  formControlName="date"
                  [class.error]="finalCompensationForm.get('date')?.invalid && finalCompensationForm.get('date')?.touched"
                />
                @if (finalCompensationForm.get('date')?.invalid && finalCompensationForm.get('date')?.touched) {
                  <span class="error-message">Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø·Ù„ÙˆØ¨</span>
                }
              </div>

              <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-add">
                  + Ø¥Ø¶Ø§ÙØ©
                </button>
              </div>
            </div>
          </form>

          <!-- Table -->
          @if (finalCompensationList().length > 0) {
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ</th>
                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø­Ø°Ù</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of finalCompensationList(); track $index) {
                    <tr>
                      <td>{{ $index + 1 }}</td>
                      <td>{{ item.checkNumber }}</td>
                      <td>{{ item.value }}</td>
                      <td>{{ item.date }}</td>
                      <td>
                        <button 
                          type="button" 
                          class="btn-delete" 
                          (click)="deleteFinalCompensation($index)"
                          title="Ø­Ø°Ù"
                        >
                          ğŸ—‘ï¸
                        </button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-state">
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª. Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© ØªØ¹ÙˆÙŠØ¶ Ø¬Ø¯ÙŠØ¯.</p>
            </div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeFinalCompensationModal()">
            Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚
          </button>
          <button type="button" class="btn btn-tertiary" (click)="closeFinalCompensationModal()">
            Ø¥Ù„ØºØ§Ø¡
          </button>
        </div>
      </div>
    </div>
  }
</div>
