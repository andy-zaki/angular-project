<app-header 
  [pageTitle]="'بيانات الفترة الدراسية'"
  [showBackButton]="true"
  [showHomeButton]="true"
  (backClicked)="navigateBack()"
  (homeClicked)="goHome()"
  (logoutClicked)="logout()"
></app-header>

<div class="container">
  <div class="page-content">
    <h1>بيانات الفترة الدراسية</h1>
    <p class="subtitle">أدخل البيانات للاستعلام عن الفترات الدراسية</p>

    <!-- Search Form -->
    <div class="form-wrapper">
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
        <div class="form-row">
          <div class="form-group">
            <label for="buildingCode">كود المبنى <span class="required">*</span></label>
            <input 
              type="text" 
              id="buildingCode" 
              formControlName="buildingCode"
              placeholder="أدخل كود المبنى"
              [class.error]="searchForm.get('buildingCode')?.invalid && searchForm.get('buildingCode')?.touched"
            />
            @if (searchForm.get('buildingCode')?.invalid && searchForm.get('buildingCode')?.touched) {
              <span class="error-message">كود المبنى مطلوب</span>
            }
          </div>

          <div class="form-group">
            <label for="centerCode">كود المركز <span class="required">*</span></label>
            <input 
              type="text" 
              id="centerCode" 
              formControlName="centerCode"
              placeholder="أدخل كود المركز"
              [class.error]="searchForm.get('centerCode')?.invalid && searchForm.get('centerCode')?.touched"
            />
            @if (searchForm.get('centerCode')?.invalid && searchForm.get('centerCode')?.touched) {
              <span class="error-message">كود المركز مطلوب</span>
            }
          </div>

          <div class="form-group">
            <label for="branchCode">كود الفرع <span class="required">*</span></label>
            <input 
              type="text" 
              id="branchCode" 
              formControlName="branchCode"
              placeholder="أدخل كود الفرع"
              [class.error]="searchForm.get('branchCode')?.invalid && searchForm.get('branchCode')?.touched"
            />
            @if (searchForm.get('branchCode')?.invalid && searchForm.get('branchCode')?.touched) {
              <span class="error-message">كود الفرع مطلوب</span>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <span>🔍</span>
            عرض البيانات
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Results Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>نتائج الفترة الدراسية</h2>
        <button class="modal-close" (click)="closeModal()">×</button>
      </div>

      <div class="modal-body">
        @if (studyPeriodData().length > 0) {
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>الفترة</th>
                  <th>اسم المدرسة</th>
                  <th>النوع</th>
                  <th>عدد التلاميذ بنين</th>
                  <th>عدد التلاميذ بنات</th>
                  <th>مرحلة الفترة</th>
                </tr>
              </thead>
              <tbody>
                @for (item of studyPeriodData(); track $index) {
                  <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ item.period }}</td>
                    <td>{{ item.schoolName }}</td>
                    <td>{{ item.type }}</td>
                    <td>{{ item.boysCount }}</td>
                    <td>{{ item.girlsCount }}</td>
                    <td>{{ item.periodStage }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="empty-state">
            <p>لا توجد بيانات متاحة</p>
          </div>
        }
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="closeModal()">إغلاق</button>
      </div>
    </div>
  </div>
}
